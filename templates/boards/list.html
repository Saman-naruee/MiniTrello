{% extends 'base.html' %}
{% load static %}

{% block title %}My Boards - MiniTrello{% endblock %}

{% block extra_head %}
<!-- Alpine.js for interactivity -->
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
<!-- HTMX for API calls -->
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
{% endblock %}

{% block content %}
<div class="container-fluid" x-data="boardsApp()">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h2 mb-0">
                    <i class="fas fa-trello text-primary me-2"></i>
                    My Boards
                </h1>
                <button 
                    class="btn btn-primary"
                    @click="showCreateModal = true"
                    x-show="!showCreateModal">
                    <i class="fas fa-plus me-2"></i>Create Board
                </button>
            </div>
        </div>
    </div>

    <!-- Boards Grid -->
    <div class="row" id="boards-container">
        <!-- Boards will be loaded here via htmx -->
        <div class="col-12 text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <!-- Create Board Modal -->
    <div class="modal fade" 
         x-show="showCreateModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         style="display: none;"
         tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Board</h5>
                    <button type="button" class="btn-close" @click="showCreateModal = false"></button>
                </div>
                <form hx-post="/api/boards/"
                      hx-target="#boards-container"
                      hx-swap="innerHTML"
                      @submit="createBoard()"
                      class="modal-body">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="board-title" class="form-label">Board Title</label>
                        <input type="text" 
                               class="form-control" 
                               id="board-title" 
                               name="title" 
                               required 
                               maxlength="255"
                               placeholder="Enter board title">
                    </div>
                    <div class="mb-3">
                        <label for="board-description" class="form-label">Description (Optional)</label>
                        <textarea class="form-control" 
                                  id="board-description" 
                                  name="description" 
                                  rows="3"
                                  placeholder="Enter board description"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="board-color" class="form-label">Board Color</label>
                        <select class="form-select" id="board-color" name="color" required>
                            <option value="blue">Blue</option>
                            <option value="green">Green</option>
                            <option value="yellow">Yellow</option>
                            <option value="red">Red</option>
                            <option value="purple">Purple</option>
                            <option value="orange">Orange</option>
                            <option value="pink">Pink</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" @click="showCreateModal = false">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Board</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" 
         x-show="showDeleteModal" 
         x-transition
         style="display: none;"
         tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete Board</h5>
                    <button type="button" class="btn-close" @click="showDeleteModal = false"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete "<span x-text="boardToDelete?.title"></span>"?</p>
                    <p class="text-danger"><small>This action cannot be undone.</small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @click="showDeleteModal = false">Cancel</button>
                    <button type="button" 
                            class="btn btn-danger"
                            @click="deleteBoard()">
                        Delete Board
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Load boards on page load -->
<div hx-get="/boards/partials/boards/" 
     hx-trigger="load" 
     hx-target="#boards-container" 
     hx-swap="innerHTML">
</div>

<script>
function boardsApp() {
    return {
        showCreateModal: false,
        showDeleteModal: false,
        boardToDelete: null,
        
        // Show delete confirmation modal
        confirmDelete(board) {
            this.boardToDelete = board;
            this.showDeleteModal = true;
        },
        
        // Delete board via htmx
        deleteBoard() {
            if (this.boardToDelete) {
                htmx.ajax('DELETE', `/api/boards/${this.boardToDelete.id}/`, {
                    target: `#board-${this.boardToDelete.id}`,
                    swap: 'outerHTML'
                });
                this.showDeleteModal = false;
                this.boardToDelete = null;
            }
        },
        
        // Handle board creation
        createBoard() {
            this.showCreateModal = false;
            // Reload boards list after creation
            setTimeout(() => {
                htmx.ajax('GET', '/boards/partials/boards/', {
                    target: '#boards-container',
                    swap: 'innerHTML'
                });
            }, 100);
        }
    }
}
</script>
{% endblock %}
