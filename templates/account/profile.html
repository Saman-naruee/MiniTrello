{% extends 'base.html' %}
{% load i18n %}
{% load socialaccount %}
{% block title %}MiniTrello - Profile{% endblock %}
{% block nav_profile_active %}active{% endblock %}
{% block content %}
<div class="row">
<<<<<<< HEAD
<div class="col-md-8 offset-md-2">
<div class="card">
<div class="card-header d-flex justify-content-between align-items-center">
<h2>{% trans "User Profile" %}</h2>
<button @click="$dispatch('open-modal', {id: 'edit-profile-modal'})" class="btn btn-sm btn-outline-primary" x-data="{}">
<i class="fas fa-edit me-1"></i>{% trans "Edit Profile" %}</button>
</div>
<div class="card-body" id="profile-info">
<div class="mb-3">
<h4>{% trans "Account Information" %}</h4>
<p><strong>Email:</strong> {{ user.email }}</p>
<p><strong>Joined:</strong> {{ user.date_joined|date:"F d, Y" }}</p>
</div>
{% if user.socialaccount_set.all %}
<div class="mb-3">
<h4>{% trans "Connected Accounts" %}</h4>
<ul class="list-group">
{% for account in user.socialaccount_set.all %}
<li class="list-group-item d-flex justify-content-between align-items-center">
<div>
{{ account.provider|title }}
<small class="text-muted">(Connected on {{ account.date_added|date:"M d, Y" }})</small>
</div>
<button class="btn btn-sm btn-outline-danger" hx-confirm="Are you sure you want to disconnect this account?" hx-delete="{% url 'socialaccount_connections' %}?account={{ account.id }}" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}' hx-swap="outerHTML" hx-target="#profile-info">
<i class="fas fa-unlink"></i>{% trans "Disconnect" %}</button>
</li>
{% endfor %}
</ul>
</div>
{% endif %}
<div class="mt-4">
<a class="btn btn-primary" href="{% url 'Home' %}">{% trans "Back to Home" %}</a>
<a class="btn btn-outline-secondary" href="{% url 'socialaccount_connections' %}">{% trans "Manage Social Accounts" %}</a>
<button @click="$dispatch('open-modal', {id: 'change-password-modal'})" class="btn btn-outline-warning" x-data="{}">{% trans "Change Password" %}</button>
</div>
</div>
</div>
</div>
=======
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2>User Profile</h2>
                <a href="{% url 'accounts:profile_update' %}" class="btn btn-sm btn-outline-secondary">Edit Profile</a>
                </button>
            </div>
            <div class="card-body" id="profile-info">
                <div class="mb-3">
                    <h4>Account Information</h4>
                    <p><strong>Email:</strong> {{ user.email }}</p>
                    <p><strong>Joined:</strong> {{ user.date_joined|date:"F d, Y" }}</p>
                </div>
                
                {% if user.socialaccount_set.all %}
                    <div class="mb-3">
                        <h4>Connected Accounts</h4>
                        <ul class="list-group">
                        {% for account in user.socialaccount_set.all %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    {{ account.provider|title }}
                                    <small class="text-muted">(Connected on {{ account.date_added|date:"M d, Y" }})</small>
                                </div>
                                <button class="btn btn-sm btn-outline-danger"
                                        hx-delete="{% url 'socialaccount_connections' %}?account={{ account.id }}"
                                        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                                        hx-confirm="Are you sure you want to disconnect this account?"
                                        hx-target="#profile-info"
                                        hx-swap="outerHTML">
                                    <i class="fas fa-unlink"></i> Disconnect
                                </button>
                            </li>
                        {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                
                <div class="mt-4">
                    <a href="{% url 'Home' %}" class="btn btn-primary">Back to Home</a>
                    <a href="{% url 'socialaccount_connections' %}" class="btn btn-outline-secondary">Manage Social Accounts</a>
                    <button class="btn btn-outline-warning" 
                            x-data="{}" 
                            @click="$dispatch('open-modal', {id: 'change-password-modal'})">
                        Change Password
                    </button>
                </div>
            </div>
        </div>
    </div>
>>>>>>> 335f79bbb568cf71f2197d7e4eae0a5477f39bd5
</div>
<!-- Edit Profile Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto" style="display: none;" x-data="{
open: false,
displayName: '{{ user.get_full_name|default:'' }}',
preferredLanguage: '{{ user.profile.preferred_language|default:'en' }}' || 'en',
errors: {},
loading: false,
languages: [
{ code: 'en', name: 'English' },
{ code: 'fa', name: 'فارسی' },
{ code: 'fr', name: 'Français' },
{ code: 'es', name: 'Español' }
],
submitForm() {
this.loading = true;
this.errors = {};
const formData = new FormData();
formData.append('display_name', this.displayName);
formData.append('preferred_language', this.preferredLanguage);
formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
fetch('/api/profile/update/', {
method: 'POST',
body: formData,
headers: {
'X-Requested-With': 'XMLHttpRequest'
}
})
.then(response =&gt; response.json())
.then(data =&gt; {
if (data.success) {
this.open = false;
// Refresh the profile section
htmx.trigger('#profile-info', 'refreshProfile');
} else if (data.errors) {
this.errors = data.errors;
}
this.loading = false;
})
.catch(error =&gt; {
console.error('Error:', error);
this.errors = {'__all__': ['An unexpected error occurred. Please try again.']};
this.loading = false;
});
}
}" x-on:keydown.escape.window="open = false" x-on:open-modal.window="if ($event.detail.id === 'edit-profile-modal') { open = true; }" x-show="open">
{% trans "Modal backdrop" %}
<div class="fixed inset-0 bg-black bg-opacity-50" x-on:click="open = false" x-show="open"></div>
{% trans "Modal content" %}
<div class="modal d-block" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">{% trans "Edit Profile" %}</h5>
<button @click="open = false" class="btn-close" type="button"></button>
</div>
<div class="modal-body">
<form @submit.prevent="submitForm">
<div class="mb-3">
<label class="form-label" for="displayName">{% trans "Display Name" %}</label>
<input class="form-control" id="displayName" type="text" x-model="displayName"/>
<div class="text-danger mt-1" x-show="errors.display_name" x-text="errors.display_name"></div>
</div>
<div class="mb-3">
<label class="form-label" for="preferredLanguage">{% trans "Preferred Language" %}</label>
<select class="form-select" id="preferredLanguage" x-model="preferredLanguage">
<template :key="lang.code" x-for="lang in languages">
<option :value="lang.code" x-text="lang.name"></option>
</template>
</select>
<div class="text-danger mt-1" x-show="errors.preferred_language" x-text="errors.preferred_language"></div>
</div>
<div class="alert alert-danger" x-show="errors.__all__" x-text="errors.__all__"></div>
<div class="modal-footer">
<button @click="open = false" class="btn btn-secondary" type="button">{% trans "Cancel" %}</button>
<button :disabled="loading" class="btn btn-primary" type="submit">
<span class="spinner-border spinner-border-sm me-1" x-show="loading"></span>{% trans "Save Changes" %}</button>
</div>
</form>
</div>
</div>
</div>
</div>
</div>
<!-- Change Password Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto" style="display: none;" x-data="{
open: false,
oldPassword: '',
newPassword1: '',
newPassword2: '',
errors: {},
loading: false,
submitForm() {
this.loading = true;
this.errors = {};
const formData = new FormData();
formData.append('oldpassword', this.oldPassword);
formData.append('password1', this.newPassword1);
formData.append('password2', this.newPassword2);
formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
fetch('{% url 'account_change_password' %}', {
method: 'POST',
body: formData,
headers: {
'X-Requested-With': 'XMLHttpRequest'
}
})
.then(response =&gt; {
if (response.redirected) {
window.location.href = response.url;
return;
}
return response.json();
})
.then(data =&gt; {
if (data &amp;&amp; data.form &amp;&amp; data.form.errors) {
this.errors = data.form.errors;
}
this.loading = false;
})
.catch(error =&gt; {
console.error('Error:', error);
this.errors = {'__all__': ['An unexpected error occurred. Please try again.']};
this.loading = false;
});
}
}" x-on:keydown.escape.window="open = false" x-on:open-modal.window="if ($event.detail.id === 'change-password-modal') { open = true; }" x-show="open">
{% trans "Modal backdrop" %}
<div class="fixed inset-0 bg-black bg-opacity-50" x-on:click="open = false" x-show="open"></div>
{% trans "Modal content" %}
<div class="modal d-block" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">{% trans "Change Password" %}</h5>
<button @click="open = false" class="btn-close" type="button"></button>
</div>
<div class="modal-body">
<form @submit.prevent="submitForm">
<div class="mb-3">
<label class="form-label" for="oldPassword">{% trans "Current Password" %}</label>
<input class="form-control" id="oldPassword" required="" type="password" x-model="oldPassword"/>
<div class="text-danger mt-1" x-show="errors.oldpassword" x-text="errors.oldpassword"></div>
</div>
<div class="mb-3">
<label class="form-label" for="newPassword1">{% trans "New Password" %}</label>
<input class="form-control" id="newPassword1" required="" type="password" x-model="newPassword1"/>
<div class="text-danger mt-1" x-show="errors.password1" x-text="errors.password1"></div>
</div>
<div class="mb-3">
<label class="form-label" for="newPassword2">{% trans "Confirm New Password" %}</label>
<input class="form-control" id="newPassword2" required="" type="password" x-model="newPassword2"/>
<div class="text-danger mt-1" x-show="errors.password2" x-text="errors.password2"></div>
</div>
<div class="alert alert-danger" x-show="errors.__all__" x-text="errors.__all__"></div>
<div class="modal-footer">
<button @click="open = false" class="btn btn-secondary" type="button">{% trans "Cancel" %}</button>
<button :disabled="loading" class="btn btn-primary" type="submit">
<span class="spinner-border spinner-border-sm me-1" x-show="loading"></span>{% trans "Change Password" %}</button>
</div>
</form>
</div>
</div>
</div>
</div>
</div>
{% endblock %}