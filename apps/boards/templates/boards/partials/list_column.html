<div class="list-column" id="list-{{ list.id }}">
    <div class="card list-card h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">{{ list.title }}</h6>
            <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    ...
                </button>
                <ul class="dropdown-menu">
                    <li><button class="dropdown-item" @click="addCardToList({{ list.id }}, {{ board.id }})">Add Card</button></li>
                    <li><button class="dropdown-item" 
                                hx-delete="{% url 'boards:delete_list' board.id list.id %}"
                                hx-target="#list-{{ list.id }}"
                                hx-swap="outerHTML"
                                hx-confirm="Are you sure?">Delete List</button></li>
                </ul>
            </div>
        </div>
        
        <div class="card-body p-2" id="cards-container-{{ list.id }}">
            {# ❗❗❗ اصلاح اصلی: حالا همه آبجکت‌ها را به پارت بعدی پاس می‌دهیم #}
            {% for card in list.prefetched_cards %}
                {% include "boards/partials/card_item.html" with card=card list=list board=board %}
            {% empty %}
                <div class="text-center text-muted p-3">No cards yet.</div>
            {% endfor %}
        </div>
        
        <div class="card-footer p-2">
            {# این دکمه حالا به درستی کار خواهد کرد چون `board.id` در دسترس است #}
            <button class="btn btn-outline-primary btn-sm w-100" @click="addCardToList({{ list.id }}, {{ board.id }})">
                + Add Card
            </button>
        </div>
    </div>
</div>
