{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% load board_extras %}
{% block title %}{{ board.title }} - MiniTrello{% endblock %}
{% block extra_head %}
<script defer="" src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
<!-- Custom CSS -->
<link href="{% static 'boards/css/boards.css' %}" rel="stylesheet"/>
<style>
.board-header {
background: linear-gradient(135deg, {{ board.color }}20, {{ board.color }}40);
border-bottom: 3px solid {{ board.color }};
}
.list-container {
min-height: calc(100vh - 200px);
overflow-x: auto;
}
.list-column {
min-width: 300px;
max-width: 300px;
}
.card-item {
cursor: pointer;
transition: all 0.2s ease;
}
.card-item:hover {
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.priority-badge {
font-size: 0.7rem;
padding: 0.2rem 0.4rem;
}
</style>
{% endblock %}
{% block content %}
<!-- In your board detail page -->
<button class="btn btn-danger" data-bs-target="#modal-container" data-bs-toggle="modal" hx-get="{% url 'delete_board' board.id %}" hx-swap="innerHTML" hx-target="#modal-container">{% trans "Delete Board" %}</button>
<div class="container-fluid p-0" x-data="boardApp()">
{% trans "Board Header" %}
<div class="board-header p-3 mb-3">
<div class="container-fluid">
<div class="d-flex justify-content-between align-items-center">
<div>
<h1 class="h3 mb-1">{{ board.title }}</h1>
{% if board.description %}
<p class="text-muted mb-0">{{ board.description }}</p>
{% endif %}
</div>
<div class="d-flex gap-2">
<button class="btn btn-outline-primary btn-sm" data-bs-target="#addListModal" data-bs-toggle="modal" hx-get="{% url 'create_list' board_id=board.id %}" hx-swap="innerHTML" hx-target="#create-list-form-container">
<i class="fas fa-plus me-1"></i>{% trans "Add List" %}</button>
<button class="btn btn-outline-secondary" hx-get="{% url 'board_members' board.id %}" hx-swap="innerHTML" hx-target="#board-members">
<i class="fas fa-users"></i>{% trans "Members" %}</button>
<div id="board-members"></div>
</div>
</div>
</div>
</div>
{% trans "Lists Container" %}
<div class="list-container d-flex gap-3 px-3" id="lists-container">
{% for list in lists %}
<div class="list-column" id="list-{{ list.id }}">
<div class="card list-card">
<div class="card-header d-flex justify-content-between align-items-center">
<h6 class="mb-0">{{ list.title }}</h6>
<div class="dropdown">
<button aria-expanded="false" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-ellipsis-v"></i>
</button>
<ul class="dropdown-menu">
<li>
<button @click="addCardToList({{ list.id }}, {{ board.id }})" class="dropdown-item">
<i class="fas fa-plus me-2"></i>{% trans "Add Card" %}</button>
</li>
<li>
<button class="dropdown-item" hx-confirm="Are you sure you want to delete this list?" hx-delete="{% url 'delete_list' board.id list.id %}" hx-swap="outerHTML" hx-target="#list-{{ list.id }}">
<i class="fas fa-trash me-2"></i>{% trans "Delete List" %}</button>
</li>
</ul>
</div>
</div>
<div class="card-body p-2" id="cards-container-{{ list.id }}">
{% for card in list.prefetched_cards %}
{% include "boards/partials/card_item.html" with card=card board_id=board.id list_id=list.id %}
{% empty %}
<div class="text-center py-3">
<p class="text-muted small mb-0">{% trans "No cards yet" %}</p>
<button @click="addCardToList({{ list.id }}, {{ board.id }})" class="btn btn-outline-primary btn-sm mt-2">
<i class="fas fa-plus me-1"></i>{% trans "Add Card" %}</button>
</div>
{% endfor %}
</div>
<div class="card-footer bg-transparent p-2">
<button @click="addCardToList({{ list.id }}, {{ board.id }})" class="btn btn-outline-primary btn-sm w-100">
<i class="fas fa-plus me-1"></i>{% trans "Add Card" %}</button>
</div>
</div>
</div>
{% empty %}
<div class="col-12 text-center py-5">
<i class="fas fa-list fa-3x text-muted mb-3"></i>
<h4 class="text-muted">{% trans "No lists yet" %}</h4>
<p class="text-muted">{% trans "Create your first list to get started!" %}</p>
<button class="btn btn-primary" data-bs-target="#addListModal" data-bs-toggle="modal" hx-get="{% url 'create_list' board_id=board.id %}" hx-swap="innerHTML" hx-target="#create-list-form-container">
<i class="fas fa-plus me-2"></i>{% trans "Create List" %}</button>
</div>
{% endfor %}
</div>
{% trans "Add List Modal" %}
<div #}="" accessibility="" add="" an="" aria-hidden="true" aria-labelledby="addListModalLabel" bootstrap="" class="modal fade" for="" id="" tabindex="-1" target="" to="" {#="">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="addListModalLabel">{% trans "Add New List" %}</h5>{% trans "{# Add an ID for accessibility #}" %}<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body" id="create-list-form-container">
{% trans "HTMX will load the form here" %}
</div>{% trans "&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD" %}<form @submit="showAddListModal = false" class="modal-body" hx-post="{% url 'boards:create_list' %}" hx-swap="beforeend" hx-target="#lists-container">
{% csrf_token %}
<input name="board" type="hidden" value="{{ board.id }}"/>
<div class="mb-3">
<label class="form-label" for="list-title">{% trans "List Title" %}</label>
<input class="form-control" id="list-title" maxlength="255" name="title" placeholder="Enter list title" required="" type="text"/>
</div>
<div class="modal-footer">
<button @click="showAddListModal = false" class="btn btn-secondary" type="button">{% trans "Cancel" %}</button>
<button class="btn btn-primary" type="submit">{% trans "Create List" %}</button>
</div>
</form>{% trans "{% trans "=======
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 489139fdbe472089d0b91d717bf1bc1f1a51740b" %}" %}</div>
</div>
</div>
{% trans "Add Card Modal" %}
<div #}="" accessibility="" add="" an="" aria-hidden="true" aria-labelledby="addCardModalLabel" bootstrap="" class="modal fade" for="" id="" tabindex="-1" target="" to="" {#="">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="addCardModalLabel">{% trans "Add New Card" %}</h5>{% trans "{# Add an ID for accessibility #}" %}<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body" id="create-card-form-container">
{% trans "HTMX will load the form here" %}
</div>{% trans "&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD" %}<form @submit="showAddCardModal = false" class="modal-body" hx-post="{% url 'boards:create_card' %}" hx-swap="beforeend" x-bind:hx-target="`#cards-container-${selectedListId}`">
{% csrf_token %}
<input name="list" type="hidden" x-bind:value="selectedListId"/>
<div class="mb-3">
<label class="form-label" for="card-title">{% trans "Card Title" %}</label>
<input class="form-control" id="card-title" maxlength="255" name="title" placeholder="Enter card title" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="card-description">{% trans "Description (Optional)" %}</label>
<textarea class="form-control" id="card-description" name="description" placeholder="Enter card description" rows="3"></textarea>
</div>
<div class="mb-3">
<label class="form-label" for="card-priority">{% trans "Priority" %}</label>
<select class="form-select" id="card-priority" name="priority">
<option value="60">Low</option>
<option selected="" value="50">Medium</option>
<option value="40">High</option>
<option value="30">Important</option>
<option value="20">Important and Urgent</option>
<option value="10">Top</option>
</select>
</div>
<div class="modal-footer">
<button @click="showAddCardModal = false" class="btn btn-secondary" type="button">{% trans "Cancel" %}</button>
<button class="btn btn-primary" type="submit">{% trans "Create Card" %}</button>
</div>
</form>{% trans "{% trans "=======
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 489139fdbe472089d0b91d717bf1bc1f1a51740b" %}" %}</div>
</div>
</div>
{% trans "Edit Card Modal" %}
<div class="modal fade" style="display: none;" tabindex="-1" x-show="showEditCardModal" x-transition="">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">{% trans "Edit Card" %}</h5>
<button @click="showEditCardModal = false" class="btn-close" type="button"></button>
</div>{% trans "&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD" %}<form =="&lt;form" hx-patch="{% url 'boards:update_card' 0 %}" x-bind:hx-patch="`/boards/cards/${editingCardId}/update/`">&gt;&gt;&gt;&gt;&gt;&gt; 489139fdbe472089d0b91d717bf1bc1f1a51740b
x-bind:hx-target="`#card-${editingCardId}`"
hx-swap="outerHTML"
@submit="showEditCardModal = false"
class="modal-body"&gt;
{% csrf_token %}
<input name="card_id" type="hidden" x-bind:value="editingCardId"/>
<div class="mb-3">
<label class="form-label" for="edit-card-title">{% trans "Card Title" %}</label>
<input class="form-control" id="edit-card-title" maxlength="255" name="title" placeholder="Enter card title" required="" type="text" x-bind:value="editingCardTitle"/>
</div>
<div class="mb-3">
<label class="form-label" for="edit-card-description">{% trans "Description (Optional)" %}</label>
<textarea class="form-control" id="edit-card-description" name="description" placeholder="Enter card description" rows="3" x-bind:value="editingCardDescription"></textarea>
</div>
<div class="mb-3">
<label class="form-label" for="edit-card-priority">{% trans "Priority" %}</label>
<select class="form-select" id="edit-card-priority" name="priority" x-bind:value="editingCardPriority">
<option value="60">Low</option>
<option value="50">Medium</option>
<option value="40">High</option>
<option value="30">Important</option>
<option value="20">Important and Urgent</option>
<option value="10">Top</option>
</select>
</div>
<div class="modal-footer">
<button @click="showEditCardModal = false" class="btn btn-secondary" type="button">{% trans "Cancel" %}</button>
<button class="btn btn-primary" type="submit">{% trans "Save Changes" %}</button>
</div>
</form>
</div>
</div>
</div>
{% trans "Members Modal Trigger (Button)" %}
<div class="d-flex justify-content-end">
<button class="btn btn-secondary" hx-get="{% url 'board_members' board.id %}" hx-swap="innerHTML" hx-target="#members-modal-content">{% trans "Members" %}</button>
</div>
{% trans "Members Modal (Bootstrap)" %}
<div aria-hidden="true" aria-labelledby="membersModalLabel" class="modal fade" id="membersModal" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="membersModalLabel">{% trans "Board Members" %}</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body" id="members-modal-content">
{% trans "HTMX will load the members list here" %}
</div>
</div>
</div>
</div>
</div>
<script>
function boardApp() {
return {
showAddListModal: false,
showAddCardModal: false, // This will be managed by Bootstrap now
showEditCardModal: false,
showMembersModal: false,
selectedListId: null,
editingCardId: null,
editingCardTitle: '',
editingCardDescription: '',
editingCardPriority: 50,
// Show add card modal for specific list
addCardToList(listId, boardId) {
this.selectedListId = listId;
// Open the Bootstrap modal first
const addCardModal = new bootstrap.Modal(document.getElementById('addCardModal'));
addCardModal.show();
// Then, trigger an HTMX GET to load the form into the modal
htmx.ajax('GET', `/boards/${boardId}/lists/${listId}/cards/create/`, {
target: `#create-card-form-container`,
swap: 'innerHTML',
});
},
// Show edit card modal
editCard(cardId, title, description, priority) {
this.editingCardId = cardId;
this.editingCardTitle = title;
this.editingCardDescription = description;
this.editingCardPriority = priority;
this.showEditCardModal = true;
}
}
}
// HTMX event listener to close the Add List Modal on successful list creation
document.body.addEventListener('htmx:afterSwap', function(evt) {
if (evt.detail.target.id === 'lists-container' && evt.detail.xhr.status === 200 && evt.detail.requestHeaders['HX-Trigger'] === 'listCreated') {
const addListModal = new bootstrap.Modal(document.getElementById('addListModal'));
addListModal.hide();
}
});
// HTMX event listener to close the Add Card Modal on successful card creation
document.body.addEventListener('htmx:afterSwap', function(evt) {
// Check if the swap was for a new card and was successful
// We're targeting #cards-container-${selectedListId} for successful card additions
// and expecting an HX-Trigger 'cardCreated' from the server.
if (evt.detail.target.closest('[id^="cards-container-"]') && evt.detail.xhr.status === 200 && evt.detail.requestHeaders['HX-Trigger'] === 'cardCreated') {
const addCardModal = new bootstrap.Modal(document.getElementById('addCardModal'));
addCardModal.hide();
}
});
</script>
{% endblock %}